# QCA OSSL

INCLUDE(CheckFunctionExists)
SET(CMAKE_REQUIRED_LIBRARIES ${OPENSSL_LIBRARIES})
CHECK_FUNCTION_EXISTS(EVP_md2 HAVE_OPENSSL_MD2)
IF (HAVE_OPENSSL_MD2)
  ADD_DEFINITIONS(-DHAVE_OPENSSL_MD2)
ENDIF (HAVE_OPENSSL_MD2)

SET(QCA_OSSL_SOURCES qca-ossl.cpp)

MY_AUTOMOC( QCA_OSSL_SOURCES )

ADD_LIBRARY(qca-ossl MODULE ${QCA_OSSL_SOURCES})
INCLUDE_DIRECTORIES(${OPENSSL_INCLUDE_DIR})
TARGET_LINK_LIBRARIES(qca-ossl ${QT_QTCORE_LIBRARY})
TARGET_LINK_LIBRARIES(qca-ossl qca)
TARGET_LINK_LIBRARIES(qca-ossl ${OPENSSL_LIBRARIES})

IF (APPLE)
  TARGET_LINK_LIBRARIES(qca-ossl crypto)
ENDIF (APPLE)

IF (WIN32)
  ADD_DEFINITIONS(-DOSSL_097)
  TARGET_LINK_LIBRARIES(qca-ossl gdi32)
  TARGET_LINK_LIBRARIES(qca-ossl wsock32)
  TARGET_LINK_LIBRARIES(qca-ossl ${OPENSSL_EAY_LIBRARIES})
ENDIF (WIN32)

INSTALL(TARGETS qca-ossl
        LIBRARY DESTINATION ${qca_PLUGINSDIR}
        ARCHIVE DESTINATION ${qca_PLUGINSDIR}
        RUNTIME DESTINATION ${qca_PLUGINSDIR}
)
